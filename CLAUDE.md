# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

ThemeKit is a Swift package for SwiftUI that provides:
1. **Core theming types** — backbone types that implement environment-aware theming (ThemeAdaptiveStyle, Codable conformances)
2. **A code generation command plugin** — reads a `theme.json` config and generates all concrete theme files (Theme, ThemeShapeStyle, ThemeColors, ThemeGradients, etc.)

The theming approach is described in detail at: https://dev.to/rozd/building-a-native-feeling-theme-system-in-swiftui-h1k

## Build & Test Commands

```bash
swift build                          # Build the package
swift test                           # Run all tests
swift test --filter <TestCase>       # Run a single test class
swift test --filter <TestCase>/<method>  # Run a single test method
swift package plugin <command-name>  # Run the command plugin locally
```

## Architecture

### Package Targets

```
Sources/
  ThemeKit/              — Core types (library, what app devs import)
  ThemeKitGenerator/     — Generation logic (library, testable)
  ThemeKitPlugin/        — Thin command plugin entry point
Tests/
  ThemeKitTests/         — Core type tests (with stub generated types)
  ThemeKitGeneratorTests/ — Generation logic tests
```

### Core Types (ThemeKit target)

- **`ThemeAdaptiveStyle<Style>`** — Generic wrapper holding `light`/`dark` variants, resolved via `ColorScheme`.
- **Codable conformances** — `Color`, `Gradient`, etc. get `Codable` conformance (via `@retroactive`) for remote/serialized theming.

### Generated Types (NOT in the package — produced per app)

Everything else is generated by the plugin into the app dev's project:
- **`ThemeShapeStyle<Style>`** — `ShapeStyle` that resolves via `KeyPath<Theme, ThemeAdaptiveStyle<Style>>` against theme + color scheme from `EnvironmentValues`. References generated `Theme` type, so must be generated.
- **`Theme`** — Root container, only includes categories present in config.
- **`ThemeColors`**, **`ThemeGradients`**, **`ThemeShadows`**, etc. — Structs with `let` properties per token.
- **`*+CopyWith.swift`** — Immutable update extensions for each struct.
- **`ShapeStyle+*.swift`** — Convenience static properties on `ShapeStyle`.
- **`Environment+Theme.swift`** — `EnvironmentValues.theme` entry (always the same content).

App devs are responsible for creating `Theme+Default.swift` with a `static let default` providing actual style values.

### Generator (ThemeKitGenerator target)

Pure functions: config in, Swift source strings out. Templates are embedded as Swift string literals (not separate files) since they're small and the dynamic parts are simple loops over token names. No external template engine.

### Config Format

JSON file (`theme.json`) with a JSON Schema at `theme.schema.json` in the repo root. Token entries are either plain strings or objects with a `style` override:

```json
{
  "colors": ["surface", { "name": "primary", "style": "primaryColor" }],
  "gradients": ["primary"]
}
```

- String `"surface"` → struct property `surface`, ShapeStyle `.surface`
- Object `{ "name": "primary", "style": "primaryColor" }` → struct property `primary`, ShapeStyle `.primaryColor` (avoids conflicts with SwiftUI built-ins)

Only categories present in config are included in generated `Theme` struct.

The config model (`TokenEntry`) is a struct with `name` and `style` properties and custom `Codable` — strings decode to both fields equal, objects require both keys. Encoding round-trips: equal name/style encodes as string.

## Key Patterns

- All types are `nonisolated`, `Sendable`, and `Codable`
- Style resolution goes through SwiftUI's `resolve(in: EnvironmentValues)` — never requires `@Environment` in views
- Every token must have both light and dark variants (no optionals/fallbacks)
- `copyWith` pattern enables immutable theme updates at runtime
- Generated `ShapeStyle` extensions constrain `Self` to `ThemeShapeStyle<ConcreteType>`
- Test targets use stub implementations of generated types for testing core types
